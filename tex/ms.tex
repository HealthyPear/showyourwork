% !TeX root = ./ms.tex
\documentclass[modern]{aastex62}
\usepackage{showyourwork}

% Bibliography stuff
\bibliographystyle{aasjournal}

\usepackage{listings}
\def\zz{\color{red}\textless\bgroup\itshape\aftergroup\endzz}
\def\endzz{\textgreater\egroup}
\definecolor{background}{rgb}{0.94,0.95,0.96}
\definecolor{linenumbers}{rgb}{0.74,0.75,0.76}
\lstdefinestyle{LaTeX}{
    language=[LaTeX]TeX,
    breaklines=true,
    keywordstyle=\color{blue},
    identifierstyle=\color{magenta},
    moredelim=**[is][\zz]{@<}{>@},
    basicstyle=\ttfamily\lst@ifdisplaystyle\scriptsize\fi,
    numbers=left,
    numberstyle=\color{linenumbers},
    xleftmargin=5pt,
    xrightmargin=5pt,
    frame=single,
    backgroundcolor=\color{background},
    belowcaptionskip=5em,
    aboveskip=2em,
    belowskip=2em,
    framesep=5pt
}
\lstdefinestyle{bash}{
    language=bash,
    basicstyle=\ttfamily\lst@ifdisplaystyle\scriptsize\fi,
    numbers=left,
    numberstyle=\color{linenumbers},
    xleftmargin=5pt,
    xrightmargin=5pt,
    frame=single,
    backgroundcolor=\color{background},
    belowcaptionskip=5em,
    aboveskip=2em,
    belowskip=2em,
    framesep=5pt
}


% Begin!
\begin{document}

% Title
\title{Show Your Work!}

% Author list
\author[\myORCID]{\myName}
\email{\myEmail}
\affil{\myAffil}

% Abstract
\begin{abstract}
    This is a sample article generated by \showyourwork, a workflow for producing open-source, fully reproducible scientific papers in \LaTeX.
    The philosophy of the workflow is straightforward: everything needed to exactly reproduce the article \emph{from scratch} is version-controlled and open-source on GitHub.
    Whenever new commits are pushed to GitHub, the paper is automatically re-compiled on the cloud.
    In this process, all of the figures in the article are generated on-the-fly from \texttt{Python} scripts and all equations are ``checked'' using associated \texttt{pytest} test scripts.
    The \showyourwork package also annotates the PDF with status badges and links to the exact scripts that generated it.
    For example, the icons in the right margin of this abstract point to the exact version of the repository that generated this PDF and to the directory containing tests that ensure the validity of the math in the paper.
    The color of the GitHub icon (\GitHubIcon) indicates the open-source ``status'' of the paper, ranging from \GitHubIconRed (issues with version control) to \GitHubIconBlue (tip top shape), and the pass/fail badge indicates whether the tests all passed (\TestPassIcon) or if one or more tests failed (\TestFailIcon).
    The \LaTeX\, stylesheet is based on the \href{https://journals.aas.org/aastex-package-for-manuscript-preparation/}{AASTeX} markup package, and the paper-building workflow is implemented using \texttt{Snakemake}.
\end{abstract}

% The rest of the paper
\section{Introduction}

The \showyourwork workflow is part of an attempt to tackle (at least in part) the ongoing reproducibility crisis in the natural sciences \citep[see, e.g.,][]{Baker2016}.
The idea behind this workflow is simple: to make it easy for authors to publish the code that generated the results (and in particular the figures) in a scientific article.
This workflow ensures that the compiled article PDF is always in sync with the code that was used to generate its results.
It does this automatically---and seamlessly---with the help of the \texttt{Snakemake} workflow management system \citep{Molder2021}, the \href{https://journals.aas.org/aastex-package-for-manuscript-preparation/}{AASTeX} markup package, the \href{https://github.com/tectonic-typesetting/tectonic}{tectonic} typesetting engine, and the \href{https://github.com/features/actions}{GitHub Actions} Continuous Integration/Deployment tool. Currently, \showyourwork requires all scripts to be in \texttt{Python}, although support for other languages will be added in the future.

\section{The workflow}

\begin{figure}[t!]
    \begin{centering}
        \includegraphics[width=\linewidth]{dag.pdf}
        \caption{
            The directed acyclic graph (DAG) corresponding to the workflow that generated this article. Honestly I'm a little surprise the universe didn't implode when this figure was generated.
        }
        \label{fig:dag}
    \end{centering}
\end{figure}

\begin{lstlisting}[style=bash]
snakemake -c1
\end{lstlisting}

\section{Figures}

Including version-controlled figures in your article requires no extra effort on the \LaTeX\, side.
Just add \lstinline[style=LaTeX]!\includegraphics{@<xxx>@.pdf}! within a \lstinline[style=LaTeX]!figure! environment and label it with \lstinline[style=LaTeX]!\label{fig:@<yyy>@}!.
This is standard \LaTeX\, practice, but it's enough information for the workflow to figure out that in order to generate the figure \lstinline[style=LaTeX]!@<xxx>@.pdf!, it needs to execute a script called \lstinline[style=LaTeX]!@<yyy>@.py! located in the top-level \texttt{figures} folder.%
\footnote{Note that other figure extensions are also supported.}

\begin{figure}[t!]
    \begin{centering}
        \includegraphics[width=0.5\linewidth]{heart.pdf}
        \caption{
            A sample plot showing the parametric ``heart curve'' given by Equation~(\ref{eq*:heart}).
            This figure was automatically generated from the \texttt{Python} file \texttt{figures/heart.py}, which is linked to in the GitHub icon in the right margin.
            The color of the margin icon indicates its status; blue means the script is version-controlled and synced with GitHub.
        }
        \label{fig:heart}
    \end{centering}
\end{figure}

As an example, consider Figure~\ref{fig:heart}, which shows the graph of a cardioid. This figure was typeset in \LaTeX\, as follows:
%
\begin{lstlisting}[style=LaTeX]
\begin{figure}[t!]
    \begin{centering}
        \includegraphics[width=0.5\linewidth]{heart.pdf}
        \caption{...}
        \label{fig:heart}
    \end{centering}
\end{figure}
\end{lstlisting}
%
The script that generated it is \texttt{figures/heart.py}, which the workflow was able to infer based on the \lstinline[style=LaTeX]!\label! command.%
\footnote{Note, importantly, that the label must always come \emph{after} the figure caption (and never inside)!}
In addition to generating the figure \texttt{heart.pdf} automatically, \showyourwork adds a \GitHubIcon icon in the right margin of the caption that links to the exact version of the script that generated it. The color of the icon corresponds to a status code:
%
\begin{center}
    \begin{tabular}{ r l }
        \GitHubIconRed    & The \texttt{Python} figure script does not exist                 \\
        \GitHubIconOrange & The \texttt{Python} figure script is not tracked by \texttt{git} \\
        \GitHubIconYellow & The \texttt{Python} figure script has uncommitted changes        \\
        \GitHubIconBlue   & The \texttt{Python} figure script is up to date
    \end{tabular}
\end{center}

\begin{figure}[t!]
    \begin{centering}
        \includegraphics[width=0.45\linewidth]{fractal_mandelbrot.pdf}
        \includegraphics[width=0.45\linewidth]{fractal_koch.pdf}
        \caption{
            A sample plot with two subpanels showing fractals. \emph{Left}: The Mandelbrot set. \emph{Right}: A Koch snowflake. Both figures were generated from the \texttt{Python} file \texttt{figures/fractal.py}, which is linked to in the GitHub icon in the right margin.
        }
        \label{fig:fractal}
    \end{centering}
\end{figure}

Multiple figures may be included in the same \lstinline[style=LaTeX]!figure! environment provided they were all generated by the same script. As an example, consider Figure~\ref{fig:fractal}, which was typeset as follows:
%
\begin{lstlisting}[style=LaTeX]
\begin{figure}[t!]
    \begin{centering}
        \includegraphics[width=0.45\linewidth]{fractal_mandelbrot.pdf}
        \includegraphics[width=0.45\linewidth]{fractal_koch.pdf}
        \caption{...}
        \label{fig:fractal}
    \end{centering}
\end{figure}
\end{lstlisting}
%
This time, \showyourwork inferred that the script \texttt{figures/fractal.py} produces two outputs: \texttt{fractal\_mandelbrot.pdf} and
\texttt{fractal\_koch.pdf}.


\section{Equations}

Here is the parametric equation for the heart in Figure~\ref{fig:heart}:
%
\begin{align}
    \label{eq*:heart}
    x & = 16 \sin^3 t                          \nonumber \\
    y & = 13 \cos t - 5 \cos\left(2 t\right) -
    2 \cos\left(3 t\right) - \cos\left(4 t\right)
\end{align}
%
for $t \in [-1, 1]$.

Here is an equation associated with a ``unit test'':
%
\begin{align}
    \label{eq:euler}
    e^{i\pi} + 1 = 0
\end{align}
%
This equation has two margin icons: the usual GitHub icon (\GitHubIcon), which points to the associated test script \texttt{tests/test\_euler.py}, and a badge indicating whether the test passed
(\TestPassIcon) or failed (\TestFailIcon).

% Bibliography
\clearpage
\bibliography{bib}

\end{document}
